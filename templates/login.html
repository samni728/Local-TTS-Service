<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title data-i18n="login_title">ç™»å½• - æœ¬åœ° TTS æœåŠ¡</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class'
      };
    </script>
  </head>
  <body class="min-h-screen flex flex-col items-center justify-center bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200">
    <div class="absolute top-2 right-4 flex gap-2">
      <button id="theme-toggle" class="p-2 rounded bg-gray-200 dark:bg-gray-700 text-sm text-gray-900 dark:text-white shadow transition-all">ğŸŒ— åˆ‡æ¢æ¨¡å¼</button>
      <button id="lang-toggle" class="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-xl shadow transition">EN</button>
    </div>
    <div class="bg-white dark:bg-gray-800 shadow-md rounded-xl p-8 w-full max-w-md text-center">
      <h1 class="text-2xl font-bold mb-2" data-i18n="login_header">ç™»å½•åˆ° TTS æœåŠ¡</h1>
      <p class="text-gray-600 dark:text-gray-400 mb-6" data-i18n="login_tip">æ­¤æœåŠ¡å·²å¯ç”¨å¯†ç ä¿æŠ¤ã€‚</p>
      <form method="post" id="login-form">
        <input type="hidden" name="next" id="next-url" />
        <div class="mb-4 text-left">
          <label for="password" class="font-semibold mb-1 block" data-i18n="password_label">å¯†ç :</label>
          <input
            type="password"
            id="password"
            name="password"
            class="w-full p-3 border border-gray-300 rounded-xl dark:bg-gray-800 dark:border-gray-600 text-gray-900 dark:text-white"
            required
            autofocus
          />
        </div>
        {% if error %}
        <div class="bg-red-200 text-red-700 p-3 rounded-xl" style="display: block">{{ error }}</div>
        {% endif %}
        <button type="submit" class="w-full mt-2 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-xl shadow transition" data-i18n="login_button">ç™» å½•</button>
      </form>
    </div>

    <footer class="mt-8 text-center text-sm text-gray-600 dark:text-gray-400">
      <a href="https://github.com/samni728/Local-TTS-Service" target="_blank" class="underline">
        Local-TTS-Service on GitHub
      </a>
    </footer>

    <script src="{{ url_for('static', filename='js/common.js') }}"></script>

    <script>
      // è¿™æ®µè„šæœ¬ä¼šåœ¨é¡µé¢åŠ è½½æ—¶ï¼Œæ™ºèƒ½åœ°è®¾ç½®é‡å®šå‘ URL
      document.addEventListener("DOMContentLoaded", function () {
        const nextUrlInput = document.getElementById("next-url");
        // ä½¿ç”¨ URLSearchParams æ¥è·å–ä»ä¸Šä¸€ä¸ªé¡µé¢ä¼ æ¥çš„ 'next' å‚æ•°
        const params = new URLSearchParams(window.location.search);
        const nextFromUrl = params.get("next");

        // ä¼˜å…ˆä½¿ç”¨ URL ä¸­çš„ next å‚æ•°ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨ document.referrer
        // document.referrer æ˜¯æŒ‡å¼•ç”¨æˆ·æ¥åˆ°å½“å‰é¡µé¢çš„ä¸Šä¸€ä¸ªé¡µé¢çš„åœ°å€
        // å¦‚æœç”¨æˆ·æ˜¯ç›´æ¥æ‰“å¼€ç™»å½•é¡µï¼Œåˆ™ referrer ä¸ºç©ºï¼Œæˆ‘ä»¬é»˜è®¤è·³è½¬åˆ°ä¸»é¡µ '/'
        let redirectTo = nextFromUrl || document.referrer || "/";

        // é˜²æ­¢é‡å®šå‘åˆ°ç™»å½•é¡µæœ¬èº«ï¼Œé€ æˆæ­»å¾ªç¯
        if (redirectTo.includes("/login")) {
          redirectTo = "/";
        }

        nextUrlInput.value = redirectTo;
      });
    </script>
  </body>
</html>
